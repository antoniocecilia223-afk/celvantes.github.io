<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cervantes | Super App Universal</title>
    <style>
        :root { --gold: #d4af37; --bg: #000; --card: #121212; --text: #fff; --wa: #202c33; --insta: #0095f6; }
        .light-mode { --bg: #f0f2f5; --card: #fff; --text: #000; }
        
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow: hidden; height: 100vh; }

        /* BARRA ADMIN */
        #admin-bar { background: var(--gold); color: #000; padding: 5px 15px; font-size: 0.8rem; font-weight: bold; display: none; justify-content: space-between; position: fixed; top: 0; width: 100%; z-index: 10000; }

        /* AUTH GATE (INSTAGRAM STYLE) */
        #auth-gate { position: fixed; inset: 0; background: #000; z-index: 9000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .auth-box { background: #000; border: 1px solid #333; padding: 30px; width: 300px; text-align: center; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; background: #121212; border: 1px solid #333; color: #fff; border-radius: 5px; box-sizing: border-box; }
        
        /* LAYOUT PRINCIPAL */
        .app-shell { display: flex; height: 100vh; flex-direction: column; }
        .content-wrapper { display: flex; flex: 1; overflow: hidden; }
        
        /* NAVBAR LATERAL */
        nav { width: 75px; border-right: 1px solid #222; display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 25px; background: var(--bg); }
        nav i { font-style: normal; font-size: 1.6rem; cursor: pointer; opacity: 0.5; }
        nav i.active { opacity: 1; color: var(--gold); }

        /* MAIN CONTENT */
        main { flex: 1; overflow-y: auto; position: relative; }
        .page { display: none; padding: 15px; animation: fadeIn 0.3s forwards; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* FEEDS */
        .yt-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .insta-stack { max-width: 500px; margin: 0 auto; }
        .media-box { width: 100%; aspect-ratio: 16/9; background: #111; border-radius: 12px; overflow: hidden; }
        video, img { width: 100%; height: 100%; object-fit: cover; }

        /* WHATSAPP UI */
        #chat-screen { position: fixed; inset: 0; background: #0b141a; z-index: 8000; display: none; flex-direction: column; }
        .chat-body { flex: 1; background: url('https://images.unsplash.com/photo-1464802686167-b939a6910659?q=80&w=1000'); background-size: cover; padding: 15px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
        .msg { padding: 8px 12px; border-radius: 8px; max-width: 70%; font-size: 0.9rem; }
        .msg.me { background: #005c4b; align-self: flex-end; }
        .msg.them { background: #202c33; align-self: flex-start; }

        /* STUDIO & CAMERA */
        #studio-overlay { position: fixed; inset: 0; background: #000; z-index: 8500; display: none; padding: 20px; }
        .filter-snap { filter: sepia(0.5) saturate(1.5); } /* Exemplo de filtro */

    </style>
</head>
<body>

    <div id="admin-bar">
        <span>üëë From_celta.5 ADMIN PANEL</span>
        <span id="stat-users">Users: 1</span>
    </div>

    <div id="auth-gate">
        <div class="auth-box">
            <h1 style="color:var(--gold); font-size: 2.5rem;">Cervantes</h1>
            <input type="text" id="reg-user" placeholder="Nome de utilizador (@)">
            <button onclick="handleAuth()" style="background:var(--insta); color:white; border:none; padding:12px; width:100%; border-radius:5px; font-weight:bold;">Entrar</button>
            <p id="auth-error" style="color:red; font-size:0.8rem; margin-top:10px;"></p>
        </div>
    </div>

    <div class="app-shell">
        <header style="padding: 15px 20px; border-bottom: 1px solid #222; display: flex; justify-content: space-between;">
            <div style="color:var(--gold); font-weight:bold;">CERVANTES</div>
            <div id="current-name" style="opacity:0.6"></div>
        </header>

        <div class="content-wrapper">
            <nav>
                <i class="active" onclick="showPage('home', this)">üè†</i>
                <i onclick="showPage('search', this)">üîç</i>
                <i onclick="showPage('studio', this)">‚ûï</i>
                <i onclick="showPage('chats', this)">üí¨</i>
                <i onclick="showPage('settings', this)">‚öôÔ∏è</i>
            </nav>

            <main>
                <section id="home" class="page active-page">
                    <div id="global-feed" class="yt-grid"></div>
                </section>

                <section id="search" class="page">
                    <input type="text" placeholder="Pesquisar utilizadores ou v√≠deos..." id="search-input" onkeyup="searchEngine()">
                    <div id="search-results"></div>
                </section>

                <section id="studio" class="page">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <button onclick="openStudio('video')" style="height:100px;">üé¨ V√≠deo</button>
                        <button onclick="openStudio('live')" style="height:100px; background:red;">üî¥ Live</button>
                        <button onclick="openStudio('text')" style="height:100px; background:#333;">‚úçÔ∏è Texto</button>
                        <button onclick="openStudio('story')" style="height:100px; background:purple;">üì∏ Story</button>
                    </div>
                </section>

                <section id="chats" class="page">
                    <div id="chat-list"></div>
                </section>

                <section id="settings" class="page">
                    <div style="background:var(--card); padding:20px; border-radius:10px;">
                        <h3>Configura√ß√µes</h3>
                        <label>Estilo do Feed Global</label>
                        <select id="feed-style" onchange="renderFeed()">
                            <option value="yt">YouTube (Grelha)</option>
                            <option value="insta">Instagram (Vertical)</option>
                        </select>
                        <label>Idioma</label>
                        <select><option>Portugu√™s</option><option>English</option><option>Fran√ßais</option></select>
                        <label>Cor do Site</label>
                        <input type="color" onchange="document.documentElement.style.setProperty('--gold', this.value)">
                        <button onclick="logout()" style="background:red; color:white; margin-top:20px;">Terminar Sess√£o</button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="studio-overlay">
        <button onclick="closeStudio()" style="float:right;">Fechar</button>
        <h2 id="studio-title">Cervantes Studio</h2>
        <div id="studio-content">
            <video id="studio-preview" autoplay muted class="filter-snap" style="width:100%; border-radius:10px;"></video>
            <input type="file" id="galeria" hidden onchange="alert('Ficheiro pronto!')">
            <button onclick="document.getElementById('galeria').click()" style="margin-top:10px;">Escolher da Galeria</button>
            <button onclick="alert('Publicado!')" style="background:var(--gold); color:black; margin-top:20px;">PUBLICAR</button>
        </div>
    </div>

    <div id="chat-screen">
        <div style="padding:15px; background:var(--wa); display:flex; gap:15px; align-items:center;">
            <span onclick="document.getElementById('chat-screen').style.display='none'">‚Üê</span>
            <strong id="chat-user">User</strong>
            <span style="margin-left:auto;">üìû üé•</span>
        </div>
        <div class="chat-body" id="chat-body"></div>
        <div style="padding:10px; background:var(--wa); display:flex; gap:10px;">
            <input type="text" id="chat-in" placeholder="Mensagem" style="margin:0">
            <button onclick="sendMsg()" style="width:auto;">‚û§</button>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('c_db') || '["From_celta.5"]');
        let userAtivo = localStorage.getItem('c_session');
        let stream = null;

        // Login Inteligente
        function handleAuth() {
            const u = document.getElementById('reg-user').value.trim();
            if(!u) return;
            if(u !== "From_celta.5" && db.includes(u)) {
                document.getElementById('auth-error').innerText = "Este nome de utilizador j√° existe!";
            } else {
                if(!db.includes(u)) db.push(u);
                localStorage.setItem('c_db', JSON.stringify(db));
                localStorage.setItem('c_session', u);
                location.reload();
            }
        }

        window.onload = () => {
            if(userAtivo) {
                document.getElementById('auth-gate').style.display = 'none';
                document.getElementById('current-name').innerText = "@" + userAtivo;
                if(userAtivo === "From_celta.5") {
                    document.getElementById('admin-bar').style.display = 'flex';
                    document.getElementById('stat-users').innerText = "Users: " + db.length;
                }
                renderFeed();
                loadUsersInChat();
            }
        };

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('nav i').forEach(i => i.classList.remove('active'));
            document.getElementById(id).classList.add('active-page');
            el.classList.add('active');
        }

        // Feed Engine
        function renderFeed() {
            const style = document.getElementById('feed-style').value;
            const feed = document.getElementById('global-feed');
            feed.className = style === 'yt' ? 'yt-grid' : 'insta-stack';
            feed.innerHTML = "";
            for(let i=0; i<6; i++) {
                feed.innerHTML += `
                    <div style="margin-bottom:20px;">
                        <div class="media-box" onmouseenter="this.querySelector('video')?.play()" onmouseleave="this.querySelector('video')?.pause()">
                            <video loop muted src="https://www.w3schools.com/html/mov_bbb.mp4"></video>
                        </div>
                        <div style="padding:10px 0;">
                            <strong>V√≠deo Inteligente #${i+1}</strong><br>
                            <small>@CervantesAI ‚Ä¢ 2M visualiza√ß√µes</small>
                        </div>
                    </div>`;
            }
        }

        // Studio & Camera
        async function openStudio(mode) {
            document.getElementById('studio-overlay').style.display = 'block';
            document.getElementById('studio-title').innerText = "Studio: " + mode.toUpperCase();
            if(mode === 'live' || mode === 'story') {
                stream = await navigator.mediaDevices.getUserMedia({video:true});
                document.getElementById('studio-preview').srcObject = stream;
            }
        }

        function closeStudio() {
            if(stream) stream.getTracks().forEach(t => t.stop());
            document.getElementById('studio-overlay').style.display = 'none';
        }

        // Chat WhatsApp
        function loadUsersInChat() {
            const list = document.getElementById('chat-list');
            db.forEach(u => {
                if(u !== userAtivo) {
                    list.innerHTML += `<div onclick="openChat('${u}')" style="padding:15px; border-bottom:1px solid #222; cursor:pointer;"><strong>${u}</strong><br><small>Online</small></div>`;
                }
            });
        }

        function openChat(user) {
            document.getElementById('chat-screen').style.display = 'flex';
            document.getElementById('chat-user').innerText = "@" + user;
        }

        function sendMsg() {
            const msg = document.getElementById('chat-in').value;
            if(!msg) return;
            document.getElementById('chat-body').innerHTML += `<div class="msg me">${msg}</div>`;
            document.getElementById('chat-in').value = "";
        }

        function logout() { localStorage.removeItem('c_session'); location.reload(); }
    </script>
</body>
</html>
