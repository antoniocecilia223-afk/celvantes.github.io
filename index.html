<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cervantes | From Celva v110</title>
    <style>
        :root { 
            --gold: #d4af37; --bg: #000; --card: #111; --text: #fff; 
            --blue: #007bff; --wa-green: #25d366; --error: #d93025;
        }
        
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }

        /* AUTH GATE - ESPA√áO FROM CELVA */
        #auth-gate { position: fixed; inset: 0; background: #0a0a0a; z-index: 100000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .auth-container { width: 400px; padding: 40px; background: #000; border: 1px solid #222; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.7); }
        .auth-input { width: 100%; padding: 16px; margin: 10px 0; background: #0a0a0a; border: 1px solid #333; border-radius: 12px; color: #fff; font-size: 16px; box-sizing: border-box; outline: none; transition: 0.3s; }
        .auth-input:focus { border-color: var(--gold); }
        .auth-btn { width: 100%; padding: 16px; background: #fff; color: #000; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 16px; }
        .from-celva { margin-top: 40px; font-size: 11px; letter-spacing: 4px; color: #333; text-transform: uppercase; font-weight: 900; }
        .g-step { display: none; animation: fadeIn 0.4s ease; }
        .g-step.active { display: block; }

        /* INTERFACE PRINCIPAL */
        .app-container { display: flex; height: 100vh; }
        nav { width: 80px; border-right: 1px solid #222; display: flex; flex-direction: column; align-items: center; padding: 30px 0; gap: 25px; background: #000; }
        nav i { font-style: normal; font-size: 1.6rem; cursor: pointer; opacity: 0.3; transition: 0.3s; padding: 10px; border-radius: 15px; }
        nav i.active { opacity: 1; color: var(--gold); background: #111; }

        main { flex: 1; overflow-y: auto; position: relative; }
        .page { display: none; padding: 25px; animation: slideUp 0.5s ease; }
        .active-page { display: block; }

        /* CARDS & UI */
        .profile-card { background: var(--card); border-radius: 30px; padding: 40px; border: 1px solid #222; text-align: center; margin-bottom: 20px; }
        .chat-item { padding: 18px; border-bottom: 1px solid #222; display: flex; align-items: center; gap: 15px; transition: 0.3s; }
        .chat-item.locked { opacity: 0.3; filter: grayscale(1); cursor: not-allowed; }
        .money-badge { background: #1a1a1a; padding: 20px; border-radius: 20px; border: 1px solid var(--gold); margin-top: 20px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="auth-gate">
        <div class="auth-container">
            <h1 style="text-align:center; margin-bottom:5px; letter-spacing:-2px;">Cervantes</h1>
            <p style="text-align:center; color:#555; margin-bottom:30px; font-size:14px;">Identidade Digital Protegida</p>
            
            <div id="step-login" class="g-step active">
                <input type="text" id="l-un" class="auth-input" placeholder="Nome de utilizador">
                <button class="auth-btn" onclick="tryLogin()">Entrar</button>
                <p style="text-align:center; font-size:13px; margin-top:20px; color:#888;">N√£o tens conta? <span onclick="goStep('step-name')" style="color:var(--gold); cursor:pointer;">Regista-te</span></p>
            </div>

            <div id="step-name" class="g-step">
                <input type="text" id="r-fn" class="auth-input" placeholder="Primeiro Nome">
                <input type="text" id="r-ln" class="auth-input" placeholder="Apelido">
                <button class="auth-btn" onclick="goStep('step-basic')">Continuar</button>
            </div>

            <div id="step-basic" class="g-step">
                <input type="date" id="r-dob" class="auth-input">
                <select id="r-gen" class="auth-input">
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                    <option value="O">Outro / N√£o dizer</option>
                </select>
                <button class="auth-btn" onclick="goStep('step-user')">Continuar</button>
            </div>

            <div id="step-user" class="g-step">
                <input type="text" id="r-un" class="auth-input" placeholder="@escolhe_o_teu_user">
                <p id="err-msg" style="color:red; font-size:12px; display:none; text-align:center;">Username indispon√≠vel!</p>
                <button class="auth-btn" onclick="finishReg()">Criar Conta Cervantes</button>
            </div>
        </div>
        <div class="from-celva">From Celva</div>
    </div>

    <div class="app-container">
        <nav>
            <i class="active" onclick="tab('home', this)">üè†</i>
            <i onclick="tab('search', this)">üîç</i>
            <i onclick="tab('chats', this)">üí¨</i>
            <i onclick="tab('account', this)">üë§</i>
        </nav>

        <main>
            <section id="home" class="page active-page">
                <h2>O teu Feed</h2>
                <div style="background:var(--card); height:400px; border-radius:25px; border:1px solid #222; display:grid; place-items:center; color:#444;">Conte√∫do em atualiza√ß√£o...</div>
            </section>

            <section id="account" class="page">
                <div class="profile-card">
                    <div style="width:100px; height:100px; background:#222; border-radius:50%; margin:0 auto 20px; border:2px solid var(--gold); display:grid; place-items:center; font-size:2rem;" id="p-icon">?</div>
                    <h2 id="p-fullname">Nome do Utilizador <span id="p-v"></span></h2>
                    <p id="p-username" style="color:#666; margin-top:-10px;">@username</p>
                    
                    <div style="display:flex; justify-content:center; gap:30px; margin-top:30px;">
                        <div><strong id="p-views" style="font-size:1.4rem;">0</strong><br><small style="color:#888;">Views</small></div>
                        <div><strong id="p-money" style="font-size:1.4rem;">0‚Ç¨</strong><br><small style="color:#888;">Saldo</small></div>
                    </div>

                    <div class="money-badge">
                        <small style="color:var(--gold); text-transform:uppercase; letter-spacing:1px;">Pr√≥xima Meta Monet√°ria</small>
                        <div id="next-goal" style="font-size:1.1rem; margin-top:5px;">Atinge 100.000 views</div>
                    </div>
                </div>
                
                <button onclick="addViews()" style="width:100%; padding:18px; background:var(--gold); color:black; border:none; border-radius:15px; font-weight:900; cursor:pointer;">SIMULAR +50.000 VIEWS</button>
                <button onclick="logout()" style="width:100%; margin-top:15px; background:none; color:#ff4444; border:none; cursor:pointer; font-weight:bold;">Sair da Identidade</button>
            </section>

            <section id="chats" class="page">
                <h2 style="margin-bottom:20px;">Cervantes Messenger</h2>
                <div id="chat-list"></div>
            </section>

            <section id="search" class="page">
                <h2>Explorar</h2>
                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;">
                    <div style="aspect-ratio:1/1; background:#111; border-radius:10px;"></div>
                    <div style="aspect-ratio:1/1; background:#111; border-radius:10px;"></div>
                    <div style="aspect-ratio:1/1; background:#111; border-radius:10px;"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('cv_final_db') || '[]');
        let current = JSON.parse(localStorage.getItem('cv_final_me') || 'null');
        let r_temp = {};

        if(current) {
            document.getElementById('auth-gate').style.display = 'none';
            updateProfile();
        }

        function goStep(id) {
            if(id === 'step-basic') {
                r_temp.fn = document.getElementById('r-fn').value;
                r_temp.ln = document.getElementById('r-ln').value;
            }
            if(id === 'step-user') {
                r_temp.dob = document.getElementById('r-dob').value;
                r_temp.gen = document.getElementById('r-gen').value;
            }
            document.querySelectorAll('.g-step').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function finishReg() {
            const un = document.getElementById('r-un').value.toLowerCase().trim();
            if(users.some(u => u.username === un)) {
                document.getElementById('err-msg').style.display = 'block';
                return;
            }
            r_temp.username = un;
            r_temp.views = 0;
            r_temp.balance = 0;
            r_temp.following = ["cervantes"];
            
            users.push(r_temp);
            localStorage.setItem('cv_final_db', JSON.stringify(users));
            localStorage.setItem('cv_final_me', JSON.stringify(r_temp));
            location.reload();
        }

        function tryLogin() {
            const un = document.getElementById('l-un').value.toLowerCase().trim();
            const found = users.find(u => u.username === un);
            if(found) {
                localStorage.setItem('cv_final_me', JSON.stringify(found));
                location.reload();
            } else alert("Conta n√£o encontrada.");
        }

        function updateProfile() {
            document.getElementById('p-fullname').innerHTML = `${current.fn} ${current.ln} ${current.views >= 1000000 ? '<span title="Verificado">‚≠ê</span>' : ''}`;
            document.getElementById('p-username').innerText = `@${current.username}`;
            document.getElementById('p-views').innerText = current.views.toLocaleString();
            document.getElementById('p-money').innerText = `${current.balance.toLocaleString()}‚Ç¨`;
            document.getElementById('p-icon').innerText = current.fn[0];
            
            // L√≥gica de Metas
            let next = "Atinge 100.000 views";
            if(current.views >= 100000) next = "Atinge 1.000.000 views";
            if(current.views >= 1000000) next = "Atinge 10.000.000 views";
            document.getElementById('next-goal').innerText = next;

            renderChats();
        }

        function addViews() {
            current.views += 50000;
            
            // Marcos de pagamento
            if(current.views === 100000) current.balance = 100;
            if(current.views === 1000000) current.balance = 1000;
            if(current.views === 10000000) current.balance = 10000;

            save();
            updateProfile();
        }

        function renderChats() {
            const list = document.getElementById('chat-list');
            list.innerHTML = "";
            users.forEach(u => {
                if(u.username === current.username) return;
                const canTalk = current.following.includes(u.username) || u.username === "cervantes";
                list.innerHTML += `
                    <div class="chat-item ${canTalk ? '' : 'locked'}">
                        <div style="width:45px; height:45px; background:#222; border-radius:50%; display:grid; place-items:center;">${u.fn[0]}</div>
                        <div style="flex:1">
                            <strong>${u.fn} ${u.views >= 1000000 ? '‚≠ê' : ''}</strong><br>
                            <small style="color:${canTalk ? 'var(--wa-green)' : '#444'}">${canTalk ? 'Podes conversar' : 'Deves seguir para desbloquear'}</small>
                        </div>
                    </div>
                `;
            });
        }

        function tab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('nav i').forEach(i => i.classList.remove('active'));
            document.getElementById(id).classList.add('active-page');
            el.classList.add('active');
        }

        function save() {
            localStorage.setItem('cv_final_me', JSON.stringify(current));
            const idx = users.findIndex(u => u.username === current.username);
            users[idx] = current;
            localStorage.setItem('cv_final_db', JSON.stringify(users));
        }

        function logout() { localStorage.removeItem('cv_final_me'); location.reload(); }
    </script>
</body>
</html>
