<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cervantes | Super App</title>
    <style>
        :root { --gold: #d4af37; --bg: #0b0b0b; --card: #1a1a1a; --text: #ffffff; --border: #2d2d2d; --wa-green: #25d366; }
        .light-mode { --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21; --border: #ddd; --wa-green: #128c7e; }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; transition: 0.3s; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* REGISTO */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid var(--gold); width: 90%; max-width: 400px; text-align: center; }

        /* HEADER & NAV */
        header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: var(--card); border-bottom: 1px solid var(--border); }
        .wrapper { display: flex; flex: 1; overflow: hidden; }
        nav { width: 70px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 25px; }
        nav i { font-style: normal; font-size: 1.6rem; cursor: pointer; color: #888; transition: 0.2s; }
        nav i.active { color: var(--gold); transform: scale(1.1); }

        /* SE√á√ïES */
        main { flex: 1; overflow-y: auto; position: relative; }
        .section { display: none; height: 100%; }
        .active-section { display: flex; flex-direction: column; }

        /* ESTILO WHATSAPP (CHATS) */
        #chats-list { flex: 1; overflow-y: auto; }
        .chat-row { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .chat-row:hover { background: rgba(255,255,255,0.05); }
        .chat-avatar { width: 55px; height: 55px; border-radius: 50%; background: #444; margin-right: 15px; overflow: hidden; border: 1px solid var(--border); }
        .chat-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .chat-info { flex: 1; }
        .chat-info h4 { margin: 0; font-size: 1rem; }
        .chat-info p { margin: 5px 0 0; font-size: 0.85rem; color: #888; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* JANELA DE CHAT PRIVADO */
        #private-chat-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); display: none; flex-direction: column; z-index: 100; }
        .chat-header { padding: 10px; background: var(--card); display: flex; align-items: center; border-bottom: 1px solid var(--border); }
        .chat-msgs { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-size: contain; }
        .msg-bubble { padding: 8px 15px; border-radius: 12px; max-width: 75%; font-size: 0.95rem; line-height: 1.4; }
        .msg-me { background: #056162; color: white; align-self: flex-end; border-top-right-radius: 0; }
        .msg-them { background: #262d31; color: white; align-self: flex-start; border-top-left-radius: 0; }

        /* CRIAR (UPLOAD & LIVE) */
        .create-box { padding: 20px; max-width: 500px; margin: auto; width: 100%; }
        .upload-area { border: 2px dashed var(--gold); padding: 30px; text-align: center; border-radius: 15px; cursor: pointer; margin: 15px 0; background: rgba(212, 175, 55, 0.05); }
        .btn-live { background: #ff0000; color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* GERAL */
        input, textarea, select { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid var(--border); background: #111; color: #fff; box-sizing: border-box; }
        .btn-gold { background: var(--gold); color: #000; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; }

        .live-indicator { width: 10px; height: 10px; background: white; border-radius: 50%; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 style="color: var(--gold); margin-bottom: 5px;">CERVANTES</h1>
            <p style="font-size: 0.9rem; color: #888;">Registo de Conta Oficial</p>
            <div style="width: 80px; height: 80px; border-radius: 50%; background: #333; margin: 20px auto; border: 2px solid var(--gold); overflow: hidden; cursor: pointer;" onclick="document.getElementById('reg-file').click()">
                <img id="reg-preview" src="https://via.placeholder.com/150?text=FOTO">
            </div>
            <input type="file" id="reg-file" hidden onchange="previewAvatar(this)">
            <input type="text" id="reg-nome" placeholder="Nome Completo">
            <input type="text" id="reg-user" placeholder="Nome de Utilizador (@)">
            <input type="password" id="reg-pass" placeholder="C√≥digo de Seguran√ßa">
            <button class="btn-gold" onclick="entrarApp()">ENTRAR</button>
        </div>
    </div>

    <header>
        <div style="font-weight: bold; color: var(--gold); letter-spacing: 1px;">CERVANTES</div>
        <div id="user-header" style="font-size: 0.8rem; opacity: 0.7;"></div>
    </header>

    <div class="wrapper">
        <nav>
            <i class="active" onclick="tab('home', this)">üè†</i>
            <i onclick="tab('chats', this)">üí¨</i>
            <i onclick="tab('create', this)">‚ûï</i>
            <i onclick="tab('channel', this)">üì∫</i>
            <i onclick="tab('settings', this)">‚öôÔ∏è</i>
        </nav>

        <main>
            <section id="home" class="section active-section" style="padding: 20px;">
                <h3 style="margin-top:0">Feed Global</h3>
                <div id="feed-items"></div>
            </section>

            <section id="chats" class="section">
                <div style="padding: 15px; background: var(--card); border-bottom: 1px solid var(--border);">
                    <h3 style="margin:0">Conversas</h3>
                </div>
                <div id="chats-list">
                    <div class="chat-row" onclick="openPrivateChat('Equipa Cervantes', 'https://via.placeholder.com/100')">
                        <div class="chat-avatar">ü§ñ</div>
                        <div class="chat-info">
                            <h4>Equipa Cervantes</h4>
                            <p>Bem-vindo ao suporte oficial!</p>
                        </div>
                    </div>
                </div>

                <div id="private-chat-view">
                    <div class="chat-header">
                        <button onclick="closePrivateChat()" style="background:none; border:none; color:var(--gold); font-size:1.5rem; cursor:pointer; margin-right:15px;">‚Üê</button>
                        <div class="chat-avatar" style="width:40px; height:40px;"><img id="chat-target-pic" src=""></div>
                        <strong id="chat-target-name">Nome</strong>
                    </div>
                    <div class="chat-msgs" id="chat-msgs-box"></div>
                    <div style="padding:10px; background:var(--card); display:flex; gap:10px;">
                        <input type="text" id="chat-input" placeholder="Mensagem" style="margin:0">
                        <button class="btn-gold" style="width:auto; padding:0 15px;" onclick="sendPrivateMsg()">‚û§</button>
                    </div>
                </div>
            </section>

            <section id="create" class="section">
                <div class="create-box">
                    <button class="btn-live" onclick="startLive()">
                        <div class="live-indicator"></div> COME√áAR LIVE AGORA
                    </button>
                    <div class="card">
                        <h3>Publicar Ficheiro</h3>
                        <div class="upload-area" onclick="document.getElementById('file-upload').click()">
                            <p>üìÇ Clica aqui para abrir a <strong>Galeria</strong> ou <strong>Ficheiros</strong></p>
                            <small>Sube V√≠deos ou Fotos do teu telem√≥vel</small>
                        </div>
                        <input type="file" id="file-upload" hidden accept="image/*,video/*">
                        <textarea id="pub-text" rows="3" placeholder="Legenda da publica√ß√£o..."></textarea>
                        <button class="btn-gold" onclick="publicarFicheiro()">PUBLICAR NO CANAL</button>
                    </div>
                </div>
            </section>

            <section id="channel" class="section" style="padding:20px;">
                <div id="my-profile-header" style="text-align:center; margin-bottom:20px;"></div>
                <h4>As minhas publica√ß√µes</h4>
                <div id="my-posts"></div>
            </section>

            <section id="settings" class="section" style="padding:20px;">
                <div class="card">
                    <h3>Defini√ß√µes</h3>
                    <button class="btn-gold" style="background:#333; color:white;" onclick="document.body.classList.toggle('light-mode')">üåì Trocar Modo (Claro/Escuro)</button>
                    <p>Idioma</p>
                    <select><option>Portugu√™s (PT)</option><option>English</option></select>
                    <button class="btn-gold" style="background:#ff4444; color:white; margin-top:20px;" onclick="location.reload()">TERMINAR SESS√ÉO</button>
                </div>
            </section>
        </main>
    </div>

    <script>
        let user = null;
        let posts = JSON.parse(localStorage.getItem('cervantes_data') || '[]');

        function previewAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => document.getElementById('reg-preview').src = e.target.result;
                reader.readAsDataURL(input.files[0]);
            }
        }

        function entrarApp() {
            const nome = document.getElementById('reg-nome').value;
            const handle = document.getElementById('reg-user').value;
            if(!nome || !handle) return alert("Preencha o Nome e o Usu√°rio!");

            user = { nome, handle, pic: document.getElementById('reg-preview').src };
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('user-header').innerText = `@${handle}`;
            render();
        }

        function tab(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
            document.querySelectorAll('nav i').forEach(i => i.classList.remove('active'));
            document.getElementById(id).classList.add('active-section');
            el.classList.add('active');
            if(id === 'chats') closePrivateChat();
        }

        /* LOGICA WHATSAPP */
        function openPrivateChat(name, pic) {
            document.getElementById('private-chat-view').style.display = 'flex';
            document.getElementById('chat-target-name').innerText = name;
            document.getElementById('chat-target-pic').src = pic;
        }

        function closePrivateChat() {
            document.getElementById('private-chat-view').style.display = 'none';
        }

        function sendPrivateMsg() {
            const input = document.getElementById('chat-input');
            const box = document.getElementById('chat-msgs-box');
            if(!input.value) return;

            box.innerHTML += `<div class="msg-bubble msg-me">${input.value}</div>`;
            input.value = "";
            box.scrollTop = box.scrollHeight;

            setTimeout(() => {
                box.innerHTML += `<div class="msg-bubble msg-them">Ol√°! Esta √© uma resposta autom√°tica do Cervantes.</div>`;
                box.scrollTop = box.scrollHeight;
            }, 1000);
        }

        /* L√ìGICA LIVE & PUBLICA√á√ÉO */
        function startLive() {
            alert("A iniciar transmiss√£o em direto...\nC√¢mara e Microfone ativos! üî¥");
        }

        function publicarFicheiro() {
            const text = document.getElementById('pub-text').value;
            const fileInput = document.getElementById('file-upload');
            if(!text && !fileInput.files[0]) return alert("Adicione um ficheiro ou texto!");

            const newPost = {
                id: Date.now(),
                user: user.handle,
                text: text,
                date: new Date().toLocaleString()
            };

            posts.unshift(newPost);
            localStorage.setItem('cervantes_data', JSON.stringify(posts));
            alert("Publicado com sucesso!");
            document.getElementById('pub-text').value = "";
            render();
            tab('home', document.querySelector('nav i'));
        }

        function apagarPost(id) {
            posts = posts.filter(p => p.id !== id);
            localStorage.setItem('cervantes_data', JSON.stringify(posts));
            render();
        }

        function render() {
            const feed = document.getElementById('feed-items');
            const myPosts = document.getElementById('my-posts');
            const profileHeader = document.getElementById('my-profile-header');
            
            feed.innerHTML = ""; myPosts.innerHTML = "";
            profileHeader.innerHTML = `
                <div class="chat-avatar" style="width:80px; height:80px; margin:0 auto;"><img src="${user.pic}"></div>
                <h2>${user.nome}</h2><p>@${user.handle}</p>
            `;

            posts.forEach(p => {
                const card = `
                    <div class="card" style="position:relative">
                        ${p.user === user.handle ? `<span style="position:absolute;top:10px;right:10px;color:red;cursor:pointer;font-size:0.7rem;" onclick="apagarPost(${p.id})">Apagar</span>` : ''}
                        <strong>@${p.user}</strong><br>
                        <p>${p.text}</p>
                        <small style="color:gray">${p.date}</small>
                    </div>
                `;
                feed.innerHTML += card;
                if(p.user === user.handle) myPosts.innerHTML += card;
            });
        }
    </script>
</body>
</html>
