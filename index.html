<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cervantes | Super App Universal</title>
    <style>
        :root { 
            --gold: #d4af37; --bg: #000; --card: #121212; --text: #fff; 
            --blue: #0095f6; --wa-green: #00a884; --red: #ff3b30;
        }
        
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }

        /* ESTILOS BASE */
        .badge { background: var(--blue); color: white; border-radius: 50%; width: 14px; height: 14px; display: inline-flex; align-items: center; justify-content: center; font-size: 8px; margin-left: 4px; vertical-align: middle; border: 1px solid #000; font-weight: bold; }
        input { width: 100%; padding: 15px; margin: 10px 0; background: #121212; border: 1px solid #333; color: #fff; border-radius: 12px; outline: none; box-sizing: border-box; }

        /* LAYOUT PRINCIPAL */
        .app-container { display: flex; height: 100vh; }
        nav { width: 70px; border-right: 1px solid #222; display: flex; flex-direction: column; align-items: center; padding: 25px 0; gap: 30px; background: #000; }
        nav i { font-style: normal; font-size: 1.6rem; cursor: pointer; opacity: 0.4; transition: 0.3s; }
        nav i.active { opacity: 1; color: var(--gold); transform: scale(1.2); }

        main { flex: 1; overflow-y: auto; padding-bottom: 80px; }
        .page { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .active-page { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* CHAT E MENSAGENS */
        #chat-window { position: fixed; inset: 0; background: #0b141a; z-index: 9000; display: none; flex-direction: column; }
        .chat-header { background: #202c33; padding: 12px 18px; display: flex; align-items: center; gap: 12px; }
        .chat-content { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); }
        .bubble { padding: 10px 14px; border-radius: 15px; max-width: 70%; font-size: 0.9rem; }
        .sent { background: #005c4b; align-self: flex-end; border-bottom-right-radius: 2px; }
        .received { background: #202c33; align-self: flex-start; border-bottom-left-radius: 2px; }

        /* INTERFACE DE CHAMADA (CALL) */
        #call-ui { position: fixed; inset: 0; background: #121212; z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: space-around; padding: 50px 0; }
        #local-video { position: absolute; top: 20px; right: 20px; width: 100px; height: 150px; background: #000; border-radius: 10px; object-fit: cover; border: 2px solid var(--gold); transform: scaleX(-1); }
        .call-avatar { width: 120px; height: 120px; border-radius: 50%; background: var(--gold); display: grid; place-items: center; font-size: 3rem; color: #000; font-weight: bold; margin-bottom: 20px; }
        .call-actions { display: flex; gap: 30px; }
        .call-btn { width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; display: grid; place-items: center; font-size: 1.5rem; color: white; }
        .btn-hangup { background: var(--red); }
        .btn-accept { background: var(--wa-green); }

        /* LOGIN */
        #auth-gate { position: fixed; inset: 0; background: #000; z-index: 11000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="auth-gate">
        <div style="text-align: center; width: 300px;">
            <h1 style="color:var(--gold); font-size: 3rem; margin-bottom: 5px;">Cervantes</h1>
            <p style="opacity:0.5; margin-bottom: 30px;">Rede Real v15</p>
            <input type="text" id="u-user" placeholder="Como te chamas?">
            <button onclick="login()" style="width:100%; padding:15px; background:var(--blue); border:none; color:white; border-radius:12px; font-weight:bold; cursor:pointer;">ENTRAR</button>
        </div>
    </div>

    <div class="app-container">
        <nav>
            <i class="active" onclick="tab('home', this)">üè†</i>
            <i onclick="tab('inbox', this)">üí¨</i>
            <i onclick="tab('settings', this)">‚öôÔ∏è</i>
        </nav>
        <main>
            <section id="home" class="page active-page">
                <h2>Explorar</h2>
                <div id="user-list"></div>
            </section>
            <section id="inbox" class="page">
                <h2>Mensagens Privadas</h2>
                <div id="chat-list"></div>
            </section>
            <section id="settings" class="page">
                <h2>Defini√ß√µes</h2>
                <button onclick="logout()" style="color:var(--red); background:none; border:none; font-weight:bold; cursor:pointer;">Sair da Conta</button>
            </section>
        </main>
    </div>

    <div id="chat-window">
        <div class="chat-header">
            <span onclick="closeChat()" style="cursor:pointer; font-size:1.2rem;">‚Üê</span>
            <div id="c-avatar" style="width:35px; height:35px; border-radius:50%; background:var(--gold); color:black; display:grid; place-items:center; font-weight:bold;">?</div>
            <strong id="c-name" style="flex:1;">Nome</strong>
            <div style="display:flex; gap:15px; font-size:1.3rem;">
                <span onclick="startCall('audio')" style="cursor:pointer;">üìû</span>
                <span onclick="startCall('video')" style="cursor:pointer;">üé•</span>
            </div>
        </div>
        <div class="chat-content" id="chat-box"></div>
        <div style="padding:15px; display:flex; gap:10px; background:#1c1c1c;">
            <input type="text" id="chat-in" placeholder="Escreve aqui..." style="margin:0; flex:1;">
            <button onclick="send()" style="background:var(--wa-green); border:none; color:white; border-radius:50%; width:45px; height:45px;">‚û§</button>
        </div>
    </div>

    <div id="call-ui">
        <video id="local-video" autoplay playsinline muted></video>
        <div style="text-align:center;">
            <div class="call-avatar" id="call-partner-avatar">?</div>
            <h2 id="call-partner-name">Nome</h2>
            <p id="call-status">A chamar...</p>
        </div>
        <div class="call-actions">
            <button class="call-btn btn-hangup" onclick="endCall()">‚úñ</button>
            <button class="call-btn btn-accept" id="btn-answer" style="display:none;" onclick="acceptCall()">‚úî</button>
        </div>
    </div>

    <script>
        let me = localStorage.getItem('cv_me');
        let users = JSON.parse(localStorage.getItem('cv_users') || '["Admin", "From_celta.5"]');
        let chats = JSON.parse(localStorage.getItem('cv_chats') || '{}');
        let activePartner = "";
        let stream = null;

        window.onload = () => {
            if(me) {
                document.getElementById('auth-gate').style.display = 'none';
                renderUsers();
            }
        };

        function login() {
            const u = document.getElementById('u-user').value.trim();
            if(!u) return;
            if(!users.includes(u)) users.push(u);
            localStorage.setItem('cv_users', JSON.stringify(users));
            localStorage.setItem('cv_me', u);
            location.reload();
        }

        function renderUsers() {
            const container = document.getElementById('user-list');
            container.innerHTML = "";
            users.forEach(u => {
                if(u === me) return;
                container.innerHTML += `
                    <div onclick="openChat('${u}')" style="background:var(--card); padding:15px; border-radius:15px; margin-bottom:10px; display:flex; align-items:center; gap:15px; cursor:pointer;">
                        <div style="width:40px; height:40px; border-radius:50%; background:var(--gold); color:black; display:grid; place-items:center; font-weight:bold;">${u[0]}</div>
                        <strong>@${u}</strong>
                    </div>`;
            });
        }

        function openChat(user) {
            activePartner = user;
            document.getElementById('chat-window').style.display = 'flex';
            document.getElementById('c-name').innerText = "@" + user;
            document.getElementById('c-avatar').innerText = user[0];
            renderMsgs();
        }

        function closeChat() { document.getElementById('chat-window').style.display = 'none'; }

        function send() {
            const input = document.getElementById('chat-in');
            if(!input.value.trim()) return;
            const id = [me, activePartner].sort().join('_');
            if(!chats[id]) chats[id] = [];
            chats[id].push({ sender: me, text: input.value });
            localStorage.setItem('cv_chats', JSON.stringify(chats));
            input.value = "";
            renderMsgs();
        }

        function renderMsgs() {
            const box = document.getElementById('chat-box');
            const id = [me, activePartner].sort().join('_');
            box.innerHTML = "";
            if(chats[id]) {
                chats[id].forEach(m => {
                    const side = m.sender === me ? 'sent' : 'received';
                    box.innerHTML += `<div class="bubble ${side}">${m.text}</div>`;
                });
            }
            box.scrollTop = box.scrollHeight;
        }

        // CHAMADAS DE VOZ E V√çDEO
        async function startCall(type) {
            document.getElementById('call-ui').style.display = 'flex';
            document.getElementById('call-partner-name').innerText = activePartner;
            document.getElementById('call-partner-avatar').innerText = activePartner[0];
            document.getElementById('call-status').innerText = type === 'video' ? "Chamada de v√≠deo..." : "Chamada de voz...";
            
            if(type === 'video') {
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    document.getElementById('local-video').srcObject = stream;
                    document.getElementById('local-video').style.display = 'block';
                } catch (e) {
                    console.log("C√¢mara bloqueada ou n√£o encontrada.");
                }
            } else {
                document.getElementById('local-video').style.display = 'none';
            }
        }

        function endCall() {
            if(stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('call-ui').style.display = 'none';
            document.getElementById('local-video').srcObject = null;
        }

        function tab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('nav i').forEach(i => i.classList.remove('active'));
            document.getElementById(id).classList.add('active-page');
            el.classList.add('active');
            if(id === 'inbox') renderUsers(); // Reaproveita a lista para o inbox
        }

        function logout() { localStorage.removeItem('cv_me'); location.reload(); }
    </script>
</body>
</html>
